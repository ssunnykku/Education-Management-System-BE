<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <script src="https://code.jquery.com/jquery-3.7.1.slim.js"
    integrity="sha256-UgvvN8vBkgO0luPSUl2s8TIlOSYRoGFAX4jlCIm9Adc=" crossorigin="anonymous"></script>
  <title>Document</title>
    <link rel="stylesheet" href="../../css/format.css"/>
    <link rel="stylesheet" href="../../css/notifications.css"/>
</head>
<body id="content-wrapper">
  <div th:insert="~{common/header :: header}"></div>
  <section id="title-wrapper">
    <h2 id="title">공지사항</h2>
  </section>
  <section id="notificationPost-section">
    <article class="notificationPost-contents">
    <div class="notification-title">
        <div id="notification-row" class="underline">
            <div class="notificationPost-title">
            </div>
            <div class="notificationPost-enroll-date">
            </div>
        </div>
        </div>
        <div id="notification-contents">
            <div class="writer">
                <span>작성자 :</span>
                <span class="notification-writer">
            </div>
            <div class="notificationPost-content">
                <p>
                </p>
            </div>
        </div>
        <pre class="notificationPost-content">
       
        </pre>
      </div>
      <div id="notificationPost-btn-wrapper">

        <button id="back-btn" class="btn-setting">목록</button>
             <button id="btn-edit" class="is-writer" >수정</button>
            <button id="delete-btn" class="is-writer" >삭제</button>

      </div>
    </article>
  </section>
  <footer></footer>
  <script>
    let urlParams = new URLSearchParams(window.location.search);
    let notificationSeq = urlParams.get('notificationSeq');

	$(document).ready(function() {
      fetch("/notifications/post/" + notificationSeq, {
        method: "get",
        headers: {
          "Content-Type": "application/json"
        }
      })
        .then(response => response.json())
        .then(data => {
          // Process and populate the HTML template
    let notificationSeq=data.notificationSeq;
    let notificationTitle = data.title;
    let notificationContent = data.description;
    let notificationDate = data.formattedNotificationDate;
    let name=data.name;
    let sameWriter=data.sameWriter;

    document.querySelector('.notificationPost-title').textContent = notificationTitle;
    document.querySelector('.notificationPost-content').textContent = notificationContent;
    // Update the date element if needed (assuming 'notificationPost-enroll-date' is for the date)
    document.querySelector('.notificationPost-enroll-date').textContent = notificationDate;
    document.querySelector('.notification-writer').textContent=name;
          console.log(sameWriter);
    if(sameWriter!==true){
            $('.is-writer').css('display', 'none');
          }
    else{
            $('.is-writer').css('display', 'block');
          }
        })
        .catch(error => {
          console.error("Error fetching data:", error);
        });
    });


	$("#back-btn").on("click", function(){
      location.href = "/ems/notifications";
    })


    const myHeaders = new Headers();
    myHeaders.append("Content-Type", "application/json");

    const graphql = JSON.stringify({
      query: "",
      variables: {}
    })
    const requestOptions = {
      method: "PATCH",
      headers: myHeaders,
      body: graphql,
      redirect: "follow"
    };

	$("#delete-btn").on("click", function(){
      fetch("/notifications/post/" + notificationSeq, requestOptions)
        .then(location.href = "/ems/notifications")
        .then((response) => response.text())
        .then((result) => console.log(result))
        .catch((error) => console.error(error))
    })
    //수정 버튼 누르면
 	$("#btn-edit").on("click", function(){
		location.href = "/ems/notification/update?notificationSeq="+notificationSeq
    })
  </script>
</body>
</html>
